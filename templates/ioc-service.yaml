apiVersion: v1
kind: Service
metadata:
  name: {{ include "ioc-chart.release" . }}
spec:
  selector:
    {{- include "ioc-chart.selectorLabels" . | nindent 4 }}
  {{- if .Values.staticIP }}
  clusterIP: {{.Values.staticIP}}
  {{- end }}
  ports:
  - name: ca-server-tcp
    port: {{ .Values.ca_server_port | default 5064 }}
    targetPort: {{ .Values.ca_server_port | default 5064 }}
    protocol: TCP
  - name: ca-server-udp
    port: {{ .Values.ca_server_port | default 5064 }}
    targetPort: {{ .Values.ca_server_port | default 5064 }}
    protocol: UDP
  - name: ca-repeater-tcp
    port: {{ add1 (.Values.ca_server_port | default 5064) }}
    targetPort: {{ add1 (.Values.ca_server_port | default 5064) }}
    protocol: TCP
  - name: ca-repeater-udp
    port: {{ add1 (.Values.ca_server_port | default 5064) }}
    targetPort: {{ add1 (.Values.ca_server_port | default 5064) }}
    protocol: UDP
  - name: pva-server-tcp
    port: {{ .Values.pva_server_port | default 5075 }}
    targetPort: {{ .Values.pva_server_port | default 5075 }}
    protocol: TCP
  - name: pva-server-udp
    port: {{ .Values.pva_server_port | default 5075 }}
    targetPort: {{ .Values.pva_server_port | default 5075 }}
    protocol: UDP
  - name: pva-broadcast-tcp
    port: {{ add1 (.Values.pva_server_port | default 5075) }}
    targetPort: {{ add1 (.Values.pva_server_port | default 5075) }}
    protocol: TCP
  - name: pva-broadcast-udp
    port: {{ add1 (.Values.pva_server_port | default 5075) }}
    targetPort: {{ add1 (.Values.pva_server_port | default 5075) }}
    protocol: UDP

  {{- if hasKey .Values.service "port" }}
  - port: {{ .Values.service.port }}
    targetPort: rest
    protocol: TCP
    name: rest
  {{- end }}
  {{- if .Values.service.http.enable }}
  - port: {{ .Values.service.http.port }}
    targetPort: http
    protocol: TCP
    name: http
  {{- end }}

